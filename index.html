<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>お問い合わせフォーム</title>
        <link rel="stylesheet" href="reboot.css">
        <link rel="stylesheet" href="Mystyle.css">
        <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    </head>
    <body>
    <header>
        <div id="header">
            <p class="title">にゃーん</p>
        </div>
    </header><!--ここまでがheader-->
    <main>
        <div class="form_wrapper">

            <div class="form_description">
                <h1 class="form_titile">お問い合わせフォーム</h1>
                <div class="description">
                    <p>※個人情報の取り扱いについて</p>
                    <p>ご入力いただきましたお客様の個人情報は、本お問い合わせに関する回答以外の目的には利用いたしません。<br></p>
                    <p><span class="required">(必須)</span>は必須入力項目です。</p>
                </div>
            </div>

            <form action="./confirm.php" method="post" name="form" id="form">

                <div class="form_content_wrapper">

                    <!-- メールアドレス -->
                    <div class="form_content">
                        <h2>メールアドレス<span class="required">(必須)</span></h2>
                        <div class="mail">
                            <label>
                                <p>ご返信先メールアドレス</p>
                                <input type="text" name="mail" autocomplete="off">
                            </label>
                        </div>
                        <div class="mail_sub">
                            <label>
                                <p>確認のため、もう一度入力してください。</p>
                                <input type="text" name="r_mail" autocomplete="off">
                            </label>
                        </div>
                    </div>

                    <!-- 名前 -->
                    <div class="form_content">
                        <label>
                            <h2>氏名<span class="required">(必須)</span></h2>
                            <input type="text" name="name" autocomplete="off">
                        </label>

                    </div>

                    <!--年齢-->
                    <div class="form_content">
                        <label>
                            <h2>年齢</h2>
                            <select name="age" class="age_selector">

                            </select>
                        </label>
                    </div>

                    <!-- 電話番号 -->
                    <div class="form_content">
                        <label>
                            <h2>ご連絡先電話番号</h2>
                            <input type="tel" name="phone_num" value="" autocomplete="off" />
                        </label>
                    </div>

                    <!-- 問い合わせ種類 -->
                    <div class="form_content">
                        <label>
                            <h2>お問い合わせの種類 <span class="required">(必須)</span></h2>
                            <select name="types" class="types">
                                <option value="">選択してください</option>
                                <option value="料金に関するお問い合わせ">料金に関するお問い合わせ</option>
                                <option value="サービスに関するお問い合わせ">サービスに関するお問い合わせ</option>
                                <option value="ご意見、ご要望">ご意見、ご要望</option>
                                <option value="その他お問い合わせ">その他お問い合わせ</option>
                            </select>
                        </label>
                    </div>

                    <!-- お問い合わせ内容 -->
                    <div class="form_content">
                        <div class="contents">
                            <label>
                                <h2>お問い合わせの内容<span class="required">(必須)</span></h2>
                                <p>200文字まで</p>
                                <textarea name="content" maxlength="200" class="content"></textarea>
                            </label>
                        </div>
                    </div>

                    <button type="button" class="but">確認</button>
                </div>

            </form><!--ここまでがform-->
        </div>


    </main><!--ここまでがmain-->
    <footer></footer>

    <script>

    addEventListener('load', () => {
      let i
      let ageSelector = document.getElementsByClassName('age_selector')
      let option = document.createElement('option')
      $('.age_selector').prepend('<option value="">選択してください</option>')
      for (i=0; i<95; i++) {
        let j=i
        $('.age_selector').append(`<option value="${j+6}">${j+6}</option>`)
      }
    })

      $('.but').click( (event) => {
        event.preventDefault()

        //formデータの取得
        let mail = $('.mail').val()
        let r_mail = $('.r_mail').val()
        let name = $('.name').val()
        let age = $('.age').val()
        let phone_num = $('.phone_num').val()
        let type = $('.types option:selected').text()
        let content = $('.content').val()

        $.ajax({
          async: false,
          url: '/confirm.php',
          dataType: 'json',
          type: 'POST',
          data: {
            mail: mail,
            r_mail: r_mail,
            name: name,
            age: age,
            phone_num: phone_num,
            type: type,
            content: content,
          }
        }).then((result) => {
          if (!result.status) {
            alert(result.message)
            $('html,body').animate({ scrollTop: 0 }, { duration: 120 })
        } else {
            $('#form').submit()
        }
        }).catch((e) => {
            alert('エラーが発生しました')
        })

      })


    </script>
    </body>
</html>
